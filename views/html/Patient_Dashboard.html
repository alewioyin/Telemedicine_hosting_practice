<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeleMedi - Homepage</title>
    <link rel="stylesheet" href="../css/patient_dashboard.css">
    <link rel="shortcut icon" href="../img/Head-Logo.png" type="image/x-icon">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBYLjIVX8jgcOWmgjvwh34RN7tDCAFEzUw&libraries=places"></script>


    <!-- LEAFLET PACKAGES -->
   <!--  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script> -->
</head>

<body>
    <div class="container">
        <div class="notifyContainer">
            <div id="successNotification">
                <img src="../img/icon-success-check.svg" alt="">
                <p class="successFormMessage"></p>
            </div>
    
            <div id="errorNotification">
                <img src="../img/icon-error-check.svg" alt="">
                <p class="errorFormMessage"></p>
            </div>
        </div>

        <div class="opacity"></div>

        <!-- POP UP DESIGNS START HERE -->
            <!-- BOOK APPOINTMENT FORM START -->
            <section class="bookAppointments">
                <div class=" bookAppointment">
                    <div class="cancel" onclick="cancel()"><img src="../img/cancel.svg" alt=""></div>
                    <form id="bookAppointmentForm" class="form" onsubmit="bookAppointmentBtn()">
                        <h2>Book an Appointment</h2>
                        <p>Fill out the appointment form below to schedule a consultation with one of our healthcare professionals.</p>
                        <div class="form-group">
                            <label>Doctor Name<span>*</span></label>
                            <select name="doctorName" id="doctorName" class="form-control">
                                <option value="">Select Doctor</option> 
                            </select>
                            <span class="message">Kindly select a doctor</span>
                        </div>

                        <div class="form-group">
                            <label>Appointment Date <span>*</span></label>
                            <input type="date" id="appointmentDate" class="form-control" >
                            <span class="message appointmentDateMsg">Kindly pick a date</span>
                        </div>

                        <div class="form-group">
                            <label>Appointment Time <span>*</span></label>
                            <input type="time" id="appointmentTime" class="form-control">
                            <span class="message appointmentTimeMsg">Kindly pick a time</span>
                        </div>

            
                        <input type="hidden" name="status" id="status" value="Scheduled">
                    
                        <button type="submit" class="bookAppointmentBtn" onsubmit="bookAppointmentBtn()">Book Appointment</button>
                    </form>
                </div>
            </section>
            <!-- BOOK APPOINTMENT FORM END -->

            <!-- BOOK APPOINTMENT FORM FOR A SPECIFIC DOCTOR START -->
            <div class="bookSpecificDoctorAppointments">
                <div class=" bookSpecificDoctorAppointment">
                    <div class="cancel" onclick="cancel()"><img src="../img/cancel.svg" alt=""></div>
                    <form id="bookSpecificDocAppointmentForm" >
                        <h2>Book an Appointment</h2>
                        <p>Fill out the appointment form below to schedule a consultation with <span class="specificDoctor"></span>.</p>
                        <div class="form-group">
                            <label>Doctor <span>*</span></label>
                            <input type="text" name="specificDoctorName" id="specificDoctorName" disabled>
                        </div>

                        <div class="form-group">
                            <label>Appointment Date <span>*</span></label>
                            <input type="date" id="specificAppointmentDate" class="form-control" >
                            <span class="message specificDateMsg">Kindly pick a date</span>
                        </div>

                        <div class="form-group">
                            <label>Appointment Time <span>*</span></label>
                            <input type="time" id="specificAppoitmentTime" class="form-control">
                            <span class="message specificTimeMsg">Kindly pick a time</span>
                        </div>

            
                        <input type="hidden" name="status" id="specificStatus" value="Scheduled">

                        <input type="hidden" name="specificDocId" id="specificDocId">
                    
                        <button type="submit" class="bookSpecificDocAppointment">Book Appointment</button>
                    </form>
                </div>
            </div>
            <!-- BOOK APPOINTMENT FORM FOR A SPECIFIC DOCTOR END -->
           
            <!-- RESCHEDULE FORM START -->
            <div class="rescheduleAppointments">
                <div class="rescheduleAppointment">
                    <div class="cancel" onclick="cancel()"><img src="../img/cancel.svg" alt=""></div>
                    <form id="rescheduleAppointmentForm">
                        <h2>Reschedule Appointment</h2>
                        <p>Fill out the appointment form below to reschedule your appointment.p>
                        <div class="form-group">
                            <label>Doctor <span>*</span></label>
                            <input type="text" name="rescheduleDoctorName" id="rescheduleDoctorName" disabled>
                        </div>

                        <div class="form-group">
                            <label>Appointment Date <span>*</span></label>
                            <input type="date" id="rescheduleApointmentDate" class="form-control" >
                            <span class="message rescheduleDateMsg">Kindly pick a date</span>
                        </div>

                        <div class="form-group">
                            <label>Appointment Time <span>*</span></label>
                            <input type="time" id="rescheduleAppoitmentTime" class="form-control">
                            <span class="message rescheduleTimeMsg">Kindly pick a time</span>
                        </div>

                        <input type="hidden" name="status" id="rescheduleStatus" value="Scheduled">

                        <input type="hidden" name="appointmentId" id="appointmentId">
                        
                        <button type="submit" class="rescheduleAppointmentBtn">Reschedule Appointment</button>
                    </form>
                </div>
            </div>
            <!-- RESCHEDULE FORM END -->

            <!-- UPLOAD PROFILE PICTURE START -->
            <div class="uploadpictures">
                <div class="uploadpicture">
                    <div class="cancel" onclick="cancel()"><img src="../img/cancel.svg" alt=""></div>

                    <div class="uploadProfilePicture">
                        <div>
                            <h2>Upload Profile Picture</h2>
                            <p>Choose an image file to upload your profile picture.</p>
                        </div>
                        
                        <!-- Profile Picture Circle -->
                        <div class="profile-picture" id="profile-picture">
                            <label for="file-input">
                                <img src="../img/user.png" alt="" id="preview">
                                <img src="../img/camera.svg" alt="camera" id="camera">
                            </label>
                        </div>
        
                        <form id="uploadDpForm" enctype="multipart/form-data">
                            <input type="file" name="profile_picture" id="file-input" accept="image/*">

                            <button class="uploadBtn">Upload</button>
                        </form>
                      
                        
                    </div>
                </div> 
            </div>
            <!-- UPLOAD PROFILE PICTURE END -->

            <!-- CHANGE PASSWORD FORM START -->
            <div class="changePassword">
                <div class="changePasswordForm">
                    <div class="cancel" onclick="cancel()"><img src="../img/cancel.svg" alt=""></div>
                    <form id="changePasswordForm">
                        <h2>Change Password</h2>
                        <p>Fill out the form below to change your password.</p>
                        <input type="hidden" name="patientId" id="patientId">
                        
                        <div class="form-group">
                            <label>Current Password <span>*</span></label>
                            <input type="password" id="currentPassword" placeholder="Current password" >
                            <span class="message currentPasswordMsg">Kindly enter your current password</span>
                        </div>

                        <div class="form-group">
                            <label>New Password <span>*</span></label>
                            <input type="password" id="newPassword" placeholder="Enter new password">
                            <span class="message newPasswordMsg">Kindly enter a new password</span>
                        </div>

                        <div class="form-group">
                            <label>Confirm New Password <span>*</span></label>
                            <input type="password" id="confirmPassword" placeholder="Confirm new password">
                            <span class="message confirmPasswordMsg">Kindly confirm your new password</span>
                        </div>

                        <button class="changePasswordBtn" onsubmit="changePassword()">Change Password</button>
                    </form>
                </div>
            </div>
            <!-- CHANGE PASSWORD FORM END -->

            <!-- LOG OUT CONFIRMATION START -->
            <section class="logoutConfirmation">
                <div class="logoutConfirm">
                    <p>Are you sure you want to log out?</p>
                    <div class="logoutBtns">
                        <button type="button" onclick="logOut()" class="logoutBtn">Yes</button>
                        <button type="button" onclick="cancel()" class="noBtn">No</button>
                    </div>     
                </div>
            </section>
            <!-- LOG OUT CONFIRMATION END -->

            <!-- LOG OUT CONFIRMATION START -->
            <section class="cancelConfirmation">
                <div class="cancelConfirm">
                    <p class="deleteMsg">Are you sure you want to cancel this appointment?</p>
                    <div class="cancelBtns">
                        <button type="button" class="cancelAppointmentBtn">Yes</button>
                        <button type="button" onclick="cancel()" class="noBtn">No</button>
                    </div>     
                </div>
            </section>
            <!-- LOG OUT CONFIRMATION END -->

            <!-- DELETE ACCOUNT CONFIRMATION START -->
            <section class="deleteAccountConfirmation">
                <div class="deleteAccountConfirm">
                    <p class="deleteMsg">Are you sure you want to delete this appointment?</p>
                    <div class="deleteBtns">
                        <button type="button" onclick="deletePatientAccounts()">Yes</button>
                        <button type="button" onclick="cancel()" class="noBtn">No</button>
                    </div>     
                </div>
            </section>
            <!-- DELETE ACCOUNT CONFIRMATION END -->

            <!-- NOTIFICATION DISPLAY START -->
             <div class="notificationDisplay">
                <div class="notifications">
                    <div class="cancel" onclick="cancel()">
                        <img src="../img/cancel.svg">
                    </div>
                    <div class="showNotificationContainer">
                        <p class="noNotification">No notification yet!</p>
                        <div class="showNotification">
                            <ul class="notificationMsgList">
                                <!-- Notification displays here -->
                            </ul>
                            <button type="button" id="notificationBtn">Mark all as Read</button>
                        </div>
                    </div>
                </div>
               
            </div>
            <!-- NOTIFICATION DISPLAY END -->
        <!-- POP UP DESIGNS END HERE -->

        <!-- MAIN CONTENT START -->
        <!-- SIDE BAR START -->
        <div class="sideBar">
            <div class="logoName">
                <img src="../img/Head-Logo.png" alt="Logo" id="logo">
                <h2>TeleMedi</h2>
            </div>
    
            <div class="navLinks">
                <div class="upNavs">
                    <div class="nav active dashboard" onclick="dashboardNav()">
                        <img src="../img/dashhboard_Icon.svg" alt="dashboard">
                        <p id="dashboard">Dashboard</p>
                    </div>
        
                    <div class="nav appointments" onclick="appointmentsNav()">
                        <img src="../img/appointment_icon.svg" alt="">
                        <p id="appointments">Appointments</p>
                    </div>
        
                    <div class="nav findDoctor" onclick="findDoctorNav()" >
                        <img src="../img/findDoctor_icon.svg">
                        <p id="findDoctor">Find Doctor</p>
                    </div>
        
                    <div class="nav healthCenter" onclick="healthCenterNav()" >
                        <img src="../img/healthLocation_icon.svg" alt="">
                        <p id="healthCenter">Health Center</p>
                    </div>
                </div>

                <div class="downNavs">
                    <div class="nav profileNav" onclick="profileContentNav()">
                        <img src="../img/profile.svg">
                        <p id="profile">Profile</p>
                    </div>
        
                    <div class="nav logout" onclick="logout()">
                        <img src="../img/logout-icon.svg">
                        <p id="logout">Logout</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- SIDE BAR END -->

        <!-- MAIN CONTENT START-->
        <div class="mainContent">
            <!-- HEADER START -->
            <div class="header">
                <div class="headerSearch">
                   <i class='bx bx-search'></i>
                    <input type="text" placeholder="Search..." id="search">  
                </div>
        
                <div class="rightheader">
                    <div class="notificationBell">
                        <img src="../img/notification.svg" alt="notification">
                        <div class="notificationCountContainer">
                            <p id="notificationCount"></p>
                        </div>
                    </div>

                    <div class="profile">
                        <p>Hello <span class="patientName"></span></p>
                        <img src="../img/user.png" class ="profilePics" alt="Profile Picture">
                
                        <img src="../img/arrow-down.svg" class="arrowDown" >
                    </div>

                    <div class="dropProfileDown">
                        <div class="link headerProfile" onclick="profileContentNav()">
                            <img src="../img/profile.svg">
                            <P id="profileName" class="patientName"></a>
                        </div>

                        <div class="link headerChangePassword" onclick="changePasswordForm()">
                            <img src="../img/changePassword-icon.svg">
                            <p>Change Password</a>
                        </div>
                        
                        <div class="link headerLogout" onclick="logout()">
                            <img src="../img/logout-icon.svg">
                            <p id="logout">Logout</p>
                        </div>

                        <div class="link headerDelete" onclick="deletePatient()">
                            <img src="../img/Delete-Icon.svg">
                            <p id="deletePatientAccount">Delete Account</p>
                        </div>
                        
                    </div>
                </div>   
            </div>
            <!-- HEADER END -->
             
            <!-- SEARCH RESULT START-->
             <section id="search-result">
                <h2>Search Results</h2>
                <div class="results">
                    <!-- SEARCH RESULTS GO HERE -->
                </div> 
                <button type="button" onclick="cancel()" id="searchCancelBtn">Cancel</button>
             </section>
            <!-- SEARCH RESULT END-->

            <!-- DASHBOARD NAV MAIN CONTENT START -->
            <section id="dashboardContent" class="content">
                <!-- WELCOME NOTE START -->
                <div class="welcomeNoteContainer">
                    <div class="welcomeNote">
                        <h1>Welcome, <span class="patientName"></span>!</h1>
                        <img src="../img/welcome_hand.png" alt="hand">
                    </div>
                    <p>Your Health, Your Schedule. Manage everything with ease.</p>
                    <button type="button" onclick="showAppointmentForm()">Book an appointment</button>
                </div>
                <!-- WELCOM E NOTE END -->

                <!-- CURRENT LOCATION START -->
                <div class="currentLocation">
                    <h2>Your Current Location</h2>
                    <div id="map">
                        <span class="mapMsg">Location loading...</span>
                    </div>
                </div>
                <!-- CURRENT LOCATION END -->

                <!-- APOOINTMENT HISTORY START -->
                <div class="appointmentHistory">
                    <h2>Your Appointment History</h2>
                    <p class="noAppointment"><!-- No appointment history yet! --></p>

                    <div class="appointmentHistoryShow">
                        <table>
                            <thead>
                                <th>Doctor</th>
                                <th>Appointment Date</th>
                                <th>Appointment Time</th>
                                <th>Status</th>
                            </thead>

                            <tbody>
                                <tr>
                                    <td class="historyAppointmentDoctorName" ></td>
                                    <td class="historyAppointmentDate"></td>
                                    <td class="historyAppointmentTime"></td>
                                    <td class="historyStatus"></td>
            
                                </tr>
                            </tbody>
                        </table>

                            <p class="viewMore">View more  &rarr;</p>
                    </div>    
                </div>
                <!-- APPOINTMENT HISTORY END -->
            </section>
            <!-- DASHBOARD NAV MAIN CONTENT END -->

            <!-- APPOINTMENT NAV MAIN CONTENT START -->
            <section id="appointmentContent" class="content">
                    <!-- WELCOME NOTE START -->
                    <div class="welcomeNoteContainer">
                        <h1>My Appointments</h1>
                        <p>Book appointments, View doctor availability and Manage your appointments conveniently.</p>
                        <button type="button" onclick="showAppointmentForm()" class="showAppointmentForm">Book an appointment</button>
                    </div>
                    <!-- WELCOME NOTE END -->
    
                    <!-- UPCOMING APPOINTMENT START -->
                    <div class="allAppointmentContent">
                        <h2>Your Upcoming Appointments</h2>
                        <p class="noUpcomingAppointment">No upcoming appointment yet!</p>
                        <div class="upcomingAppointment">
                            <table>
                                <thead>
                                    <th>Doctor</th>
                                    <th>Appointment Date</th>
                                    <th>Appointment Time</th>
                                    <th>Action</th>
                                </thead>
    
                                <tbody class="showUpcomingAppointment">
                                   <!-- Upcoming appointments displays here -->
                                </tbody>
                            </table>
                        </div>
                        <!-- UPCOMING APPOINTMENT END -->
        
                        <!-- APOOINTMENT HISTORY START -->
                        <div class="availableDoctors">
                            <h2>Available Doctors</h2>
                            <div class="showAvailableDoctors">
                                <!-- AVAILABLE DOCTORS DISPLAYS HERE --> 
                            </div>
                        </div>
                        <!-- APPOINTMENT HISTORY END -->
                    </div>
                   
            </section>
            <!-- APPOINTMENT NAV MAIN CONTENT END -->
            
            <!-- FIND DOCTOR NAV MAIN CONTENT START -->
            <section id="findDoctorContent" class="content">
                <!-- WELCOME NOTE START -->
                <div class="welcomeNoteContainer">
                    <h1>Find a Doctor</h1>
                    <p>Search for doctors by name, email or specialty.</p>
                    <form class="searchDoctorForm">
                        <input type="text" placeholder="Search for a doctor" id="searchDoctorInput">
                        <button type="submit" id="searchDocBtn">Search</button>
                    </form>
                </div>
                <!-- WELCOME NOTE END -->

                <!-- SEARCH RESULT START -->
                <div class="findDoctorsContent">
                    <div class="searchDoctor">
                        <h2>Your Result</h2>
                        <div class="showSearchDoctor">
                           <!-- Search result displays here -->
                        </div>
                    </div>
                   
                    <!-- SEARCH RESULT END -->
    
                    <!-- ALL DOCTORS START -->
                    <div class="allDoctors">
                        <h2>All Doctors</h2>
                        <div class="showAllDoctors">
                           <!-- All doctors displays here -->
                        </div>
    
                        
                    </div>
                    <!-- ALL DOCTORS END -->
                </div> 
            </section>
            <!-- FIND DOCTOR NAV MAIN CONTENT END -->

            <!-- HEALTH CENTER MAIN CONTENT START -->
            <section id="healthCenterContent" class="content">
                <!-- WELCOME NOTE START -->
                <div class="welcomeNoteContainer">
                    <h1>Find Nearby Health Centers</h1>
                    <p>Use our location-based services to locate health centers near you.</p>

                    <div class="searchHealthCenter">
                        
                        <input type="text" placeholder="Enter hospital name" id="locationInput">

                        <button type="button" id="findMylocation" onclick="searchHospital()">Search Health Center </button>

                        <button type="button" onclick="findNearbyHospitals()" id="findHealthCenters">Find Nearby Hospitals </button>
                    </div>
                </div>
                <!-- WELCOME NOTE END -->
                <div id="locationMap"></div>  
                    
                <div class="allHospitalLists">
                    <h2>Nearby Health Centers</h2>
                    <ul id="hospitalList"></ul>
                </div>     
            </section>      
            <!-- HEALTH CENTER MAIN CONTENT END -->

            <!-- PROFILE MAIN CONTENT START-->
            <section id="profileContent" class="content">
                <!-- WELCOME NOTE START -->
                <div class="welcomeNoteContainer">
                    <h1>Manage Your Profile</h1>
                    <p>Update your personal information and preferences.</p>
                    <button type="button" onclick="uploadProfilePics()" class="uploadProfilePics">Upload Profile Picture</button>
                </div>
                <!-- WELCOME NOTE END -->

                <!-- UPDATED PROFILE START -->
                <div class="allprofile">
                    <form class="profile-info">
                        <h2>Personal Information</h2>
                        <div class="row">
                            <div class="updateinfo firstName">
                                <label>First Name <span>*</span> </label>
                                <input type="text" name="first-name" id="first-name" placeholder="First name">
                                <span class="message editFnameMsg">Field cannot be empty</span>
                            </div>

                            <div class="updateinfo lastName">
                                <label>Last Name <span>*</span> </label>
                                <input type="text" name="last-name" id="last-name" placeholder="Last name">
                                <span class="message editLnameMsg">Field cannot be empty</span>
                            </div>

                            <div class="updateinfo email">
                                <label>Email <span>*</span> </label>
                                <input type="text" name="email" id="email" placeholder="Email address" disabled>
                                <span class="message editEmailMsg">Field cannot be empty</span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="updateinfo phone">
                                <label>Phone Number <span>*</span> </label>
                                <input type="text" name="phone" id="phone" placeholder="Phone number">
                                <span class="message editPhoneMsg">Field cannot be empty</span>
                            </div>
                            
                            <div class="updateinfo dob">
                                <label>Date of Birth <span>*</span> </label>
                                <input type="date" name="dob" id="dob" >
                                <span class="message editDOBMsg">Field cannot be empty</span>
                            </div>

                            <div class="updateinfo gender">
                                <label>Gender <span>*</span> </label>
                                <select name="gender" id="gender">
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Others</option>
                                </select>
                                <span class="message editGenderMsg">Field cannot be empty</span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="updateinfo address">
                                <label>Address <span>*</span> </label>
                                <textarea name="address" id="address" placeholder="Enter address"></textarea>
                                <span class="message editAddressMessage"></span>
                            </div>

                            <div class="buttons">
                                <button id="updatePatientBtn">Update Profile</button>
                                <button type="button" onclick="changePasswordForm()">Change Password</button>
                            </div>    
                        </div>
                    </form>

                    <div class="profileAppointmentHistory">
                        <h2>Your Appointment History</h2>
                        <p class="profileNoAppointment"></p>
    
                        <div class="profileAppointmentHistoryShow">
                            <table>
                                <thead>
                                    <th>S/N</th>
                                    <th>Doctor</th>
                                    <th>Appointment Date</th>
                                    <th>Appointment Time</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </thead>
    
                                <tbody class="profileAppointmentDetails">
                                  <!-- Populate details -->
                                </tbody>
                            </table>
                        </div>    
                    </div>
                    
                </div>
            </section>
            <!-- PROFILE MAIN CONTENT END-->
        </div>    
        <!-- MAIN CONTENT END -->   
    </div>

    <script src="../js/Patient_Dashboard.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="http://localhost:5501/socket.io/socket.io.js"></script>
    
    <script>
        // Socket.IO setup
        const socket = io("http://localhost:5501");
        const patient_id = "<%= patientId %>"; 
        socket.emit('joinRoom', patient_id);

        const notifyCountContainer = document.querySelector('.notificationCountContainer');
        const noNotificationDisplay = document.querySelector('.noNotification');
        const showNotificationDisplay = document.querySelector('.showNotification');
        const notificationMsgListDisplay = document.querySelector('.notificationMsgList');
        const notificationCountNumber = document.getElementById('notificationCount');


        socket.on('newNotification', (message) => {
            notificationCountNumber.textContent = parseInt(notificationCountNumber.textContent || "0") + 1;
            notifyCountContainer.style.display = 'flex';
            /* notificationCount.textContent = unreadNotificationCount; */
            noNotificationDisplay.style.display = 'none';
            showNotificationDisplay.style.display = 'flex';

            const li = document.createElement('li');
            li.textContent = message;
            notificationMsgListDisplay.appendChild(li);
        });


        // Auto-logout after 30 minutes
        let inactivityTime = () => {
            let timer;

            // Reset the timer on any user interaction
            const resetTimer = () => {
                clearTimeout(timer);
                timer = setTimeout(() => {
                    alert("Your session has expired due to inactivity. You will be logged out.");
                    window.location.href = './login.html';
                }, 30 * 60 * 1000);
            };

            // Attach events to detect user activity
            window.onload = resetTimer;
            document.onmousemove = resetTimer;
            document.onkeypress = resetTimer;
        };

        inactivityTime();

        const warningTime = 25 * 60 * 1000; // 25 minutes in milliseconds

        setTimeout(() => {
            alert('You will be logged out due to inactivity in 5 minutes.');
        }, warningTime);
    </script>
</body>
</html>